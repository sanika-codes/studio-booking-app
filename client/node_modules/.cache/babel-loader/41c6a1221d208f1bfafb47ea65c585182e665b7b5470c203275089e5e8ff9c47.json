{"ast":null,"code":"\"use strict\";\n\n// Copyright 2018 Google LLC\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//    http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.defaultErrorRedactor = exports.GaxiosError = void 0;\nconst url_1 = require(\"url\");\n/* eslint-disable @typescript-eslint/no-explicit-any */\nclass GaxiosError extends Error {\n  constructor(message, config, response, error) {\n    super(message);\n    this.config = config;\n    this.response = response;\n    this.error = error;\n    if (this.response) {\n      this.response.data = translateData(config.responseType, response === null || response === void 0 ? void 0 : response.data);\n      this.status = this.response.status;\n    }\n    if (error && 'code' in error && error.code) {\n      this.code = error.code;\n    }\n    if (config.errorRedactor) {\n      const errorRedactor = config.errorRedactor;\n      // shallow-copy config for redaction as we do not want\n      // future requests to have redacted information\n      this.config = {\n        ...config\n      };\n      if (this.response) {\n        // copy response's config, as it may be recursively redacted\n        this.response = {\n          ...this.response,\n          config: {\n            ...this.response.config\n          }\n        };\n      }\n      const results = errorRedactor({\n        config,\n        response\n      });\n      this.config = {\n        ...config,\n        ...results.config\n      };\n      if (this.response) {\n        this.response = {\n          ...this.response,\n          ...results.response,\n          config\n        };\n      }\n    }\n  }\n}\nexports.GaxiosError = GaxiosError;\nfunction translateData(responseType, data) {\n  switch (responseType) {\n    case 'stream':\n      return data;\n    case 'json':\n      return JSON.parse(JSON.stringify(data));\n    case 'arraybuffer':\n      return JSON.parse(Buffer.from(data).toString('utf8'));\n    case 'blob':\n      return JSON.parse(data.text());\n    default:\n      return data;\n  }\n}\n/**\n * An experimental error redactor.\n *\n * @param config Config to potentially redact properties of\n * @param response Config to potentially redact properties of\n *\n * @experimental\n */\nfunction defaultErrorRedactor(data) {\n  const REDACT = '<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.';\n  function redactHeaders(headers) {\n    if (!headers) return;\n    for (const key of Object.keys(headers)) {\n      // any casing of `Authentication`\n      if (/^authentication$/.test(key)) {\n        headers[key] = REDACT;\n      }\n    }\n  }\n  function redactString(obj, key) {\n    if (typeof obj === 'object' && obj !== null && typeof obj[key] === 'string') {\n      const text = obj[key];\n      if (/grant_type=/.test(text) || /assertion=/.test(text)) {\n        obj[key] = REDACT;\n      }\n    }\n  }\n  function redactObject(obj) {\n    if (typeof obj === 'object' && obj !== null) {\n      if ('grant_type' in obj) {\n        obj['grant_type'] = REDACT;\n      }\n      if ('assertion' in obj) {\n        obj['assertion'] = REDACT;\n      }\n    }\n  }\n  if (data.config) {\n    redactHeaders(data.config.headers);\n    redactString(data.config, 'data');\n    redactObject(data.config.data);\n    redactString(data.config, 'body');\n    redactObject(data.config.body);\n    try {\n      const url = new url_1.URL(data.config.url || '');\n      if (url.searchParams.has('token')) {\n        url.searchParams.set('token', REDACT);\n      }\n      data.config.url = url.toString();\n    } catch (_a) {\n      // ignore error\n    }\n  }\n  if (data.response) {\n    defaultErrorRedactor({\n      config: data.response.config\n    });\n    redactHeaders(data.response.headers);\n    redactString(data.response, 'data');\n    redactObject(data.response.data);\n  }\n  return data;\n}\nexports.defaultErrorRedactor = defaultErrorRedactor;","map":{"version":3,"names":["url_1","require","GaxiosError","Error","constructor","message","config","response","error","data","translateData","responseType","status","code","errorRedactor","results","exports","JSON","parse","stringify","Buffer","from","toString","text","defaultErrorRedactor","REDACT","redactHeaders","headers","key","Object","keys","test","redactString","obj","redactObject","body","url","URL","searchParams","has","set","_a"],"sources":["../../src/common.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}